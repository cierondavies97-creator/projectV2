# conf/retail.yaml
# Global runtime and layout configuration for all modes.

modes:
  default_mode: "backtest"        # one of "backtest", "paper", "live"
  allow_live: true                # must be true to allow runs with mode="live"

instruments:
  - instrument: "EURUSD"
    cluster_id: "majors"
    pip_size: 0.0001
    min_tick: 0.00001

  - instrument: "GBPUSD"
    cluster_id: "majors"
    pip_size: 0.0001
    min_tick: 0.00001

  - instrument: "XAUUSD"
    cluster_id: "metals"
    pip_size: 0.1
    min_tick: 0.01

  - instrument: "US500"
    cluster_id: "indices_us"
    pip_size: 0.25
    min_tick: 0.25

timeframes:
  # Anchor timeframes = memory model / HTF structure views
  anchor_tfs:
    - "M1"
    - "M5"
    - "M15"
    - "H1"
    - "D1"

  # Entry timeframes = where you actually place orders and manage brackets
  tf_entry:
    - "S1"
    - "M1"
    - "M5"
    - "M15"

risk:
  base_risk_per_trade_bps: 25           # default basis points of account per trade
  max_risk_per_instrument_bps: 150      # maximum simultaneous risk per instrument
  max_risk_per_cluster_bps: 300         # maximum simultaneous risk per cluster
  max_open_trades: 10                   # hard cap on total open trades

macro:
  enable_macro_state: true

  # Where the calendar parquet hierarchy lives; used by macro_calendar family.
  macro_calendar_source: "data/macro"

  # Default blackout window around each event if event-specific overrides are absent.
  blackout_default_minutes_pre: 15
  blackout_default_minutes_post: 15

  # Global defaults for pretrade macro handling.
  pretrade:
    enable_blackout_filter: true

    # Behaviour if a trade is in blackout:
    #   - "drop"     : remove the trade before gatekeeper/portfolio
    #   - "tag_only" : keep the trade but tag it; no size change
    on_blackout: "drop"

    # If true, and macro_is_blackout is missing on decisions, log a warning
    # and fall back to pass-through rather than crashing.
    require_macro_column: false

policies:
  # Versioned identifiers for deterministic lane outputs (auditability).
  phase_version: "phase_v1"
  threshold_bundle_id: "thresholds_default_v1"
  micro_policy_id: "micro_default_v1"
  jump_policy_id: "jump_default_v1"
  impact_policy_id: "impact_default_v1"
  options_policy_id: "options_default_v1"

thresholds:
  dealing_range_state:
    dealing_range_lookback_bars: 100
    min_range_bars: 20
    width_min_ticks: 8
    width_min_atr_mult: 0.8
    test_band_ticks: 4
    test_band_atr_mult: 0.25
    p_inside_min: 0.6
    break_fail_bars: 3
    accept_bars_min: 3
    spring_penetration_ticks: 6
    spring_penetration_atr_mult: 0.4
    reclaim_bars_max: 3
    reclaim_ticks: 4
    reclaim_atr_mult: 0.25
    trend_distance_atr: 1.5
    trend_width_mult: 1.0
    trend_bars_min: 5
    eq_level_ticks_max: 3

  microstructure_flow:
    micro_flow_window_bars: 10
    micro_imbalance_clip_abs: 0.95
    micro_intensity_window_secs: 300
    micro_ofi_method: "trade_imbalance"

  jump_variation:
    jump_base_tf: "M1"
    jump_window_bars: 30
    jump_clip_abs: 8.0

  impact_lambda:
    impact_window_bars: 50
    impact_lambda_clip_abs: 10.0
    impact_regime_edges_json: "[0.1, 0.25, 0.5, 1.0]"

  options_context:
    options_source_chain: "default"
    options_iv_solver: "brent"
    options_strike_bucket_method: "delta"
    options_rr_delta: 0.25
    options_bf_delta: 0.25
    options_term_near_days: 30
    options_term_far_days: 90
    options_mf_strike_spread_max: 0.05

paths:
  data_root: "data"
  sandbox_root: "sandbox_data"
  logs_root: "logs"

sessions:
  london_open_hour_utc: 8
  newyork_open_hour_utc: 13
  asia_open_hour_utc: 0
